<!DOCTYPE html>
<html>
  <head>
    <title>Gallery</title>
    <link rel="stylesheet" type="text/css" href="style2.css">
    <link href='https://fonts.googleapis.com/css?family=Montserrat:400,700' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Roboto:400,100,100italic,300,300italic,400italic,500,500italic,700,700italic,900italic,900' rel='stylesheet' type='text/css'>
    <script src="color-thief/src/color-thief.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
  </head>

  <body>
    <div id="container">
      <div id="galleryBox">
        <div id="innerGallery"><div id="instafeed"></div></div>

        </div>
      </div>
    </div>

  </body>
  <script type="text/javascript" src="js/instafeed.min.js"></script>
  <script type="text/javascript">
  function init() {

    var feed = new Instafeed({
      get: 'user',
      userId: '1418648047',
      resolution: 'standard_resolution',
      template: '<img class="thumbnail" src="{{model.images.standard_resolution.url}}" data-caption="{{caption}}" data-likes="{{likes}} &hearts;" data-location="{{location}}"/>',
      clientId: '66e8640ecc1c4145af1bb497cda6897c',
      // custom: '<div class="location">{{location}}</div><div class="caption">{{caption}}</div><div class="likes">{{likes}}</div>',
      custom: {
        // images: [],
        // currentImage: 0,
        // showImage: function () {
        //   var result, image, instafeeder;
        //   // if (instafeeder != null) {
        //     instafeeder = document.getElementById("instafeed");
        //     image = this.options.custom.images[this.options.custom.currentImage];
        //     result = this._makeTemplate(this.options.template, {
        //       model: image,
        //       id: image.id,
        //       link: image.link,
        //       image: image.images[this.options.resolution].url,
        //       caption: this._getObjectProperty(image, 'caption.text'),
        //       likes: image.likes.count,
        //       comments: image.comments.count,
        //       location: this._getObjectProperty(image, 'location.name')
        //     });
        //     instafeeder.innerHTML = result;
        //   }
          // }
      },
      after: expander,
      // success: function (data) {
      //   this.options.custom.images = data.data;
      //   this.options.custom.showImage.call(this);
      // }

    });

    feed.run();
    var position;
    var currentImg;
    var backgroundChanger = document.createElement("div");
    backgroundChanger.id = "backgroundChanger";
    var lightBox = document.createElement("div");
    lightBox.id = "lightBox";
    var expandedImg = document.createElement("img");
    expandedImg.id = "expandedImg";
    var likesDiv = document.createElement("div");
    likesDiv.id = "likesDiv";
    var imageInfoDiv = document.createElement("div");
    imageInfoDiv.className = "imageInfoDiv";
    var likes = document.createElement("div");
    likes.className = "likes";
    var location = document.createElement("div");
    location.className = "location";
    var thumbnails = document.getElementsByClassName("thumbnail");
    var innerGallery = document.getElementById("innerGallery");
    var next = document.createElement("div");
    next.className = "next";
    var prev = document.createElement("div");
    prev.className = "previous";
    var caption = document.createElement("div");
    caption.className = "caption";
    var imageObj = [];
    function expander() {

              for (i = 0; i < thumbnails.length; i++) {
                thumbnails[i].addEventListener("click", expandImage);
                imageObj[i] = {};
                imageObj[i].source = thumbnails[i].src;
                imageObj[i].caption = thumbnails[i].getAttribute("data-caption");
                imageObj[i].likes = thumbnails[i].getAttribute("data-likes");
                imageObj[i].location = thumbnails[i].getAttribute("data-location");
              }

            function expandImage() {
              that = this;
              expandedImg.src = this.src;

              for (var i = 0; i < imageObj.length; i++) {
                if (expandedImg.src === imageObj[i].source) {
                  position = i;
                }
              }
              document.body.appendChild(backgroundChanger);
              backgroundChanger.appendChild(lightBox);
              lightBox.appendChild(expandedImg);
              var colorThief = new ColorThief();
              colorThief.getColor(expandedImg.src);
              console.log(colorThief);
              lightBox.appendChild(prev);
              prev.innerHTML = "<";
              lightBox.appendChild(next);
              next.innerHTML = ">";
              lightBox.appendChild(likes);
              likes.innerHTML = this.getAttribute("data-likes");
              lightBox.appendChild(imageInfoDiv);
              imageInfoDiv.appendChild(caption);
              caption.innerHTML = this.getAttribute("data-caption");
              imageInfoDiv.appendChild(location);
              location.innerHTML = this.getAttribute("data-location");
              lightBox.style.width = expandedImg.width + "px";
              likesDiv.style.width = expandedImg.width + "px";
              likesDiv.style.height = expandedImg.height + "px";
              lightBox.addEventListener("mouseenter", function() {likes.style.visibility = "visible"});
              lightBox.addEventListener("mouseleave", function() {likes.style.visibility = "hidden"});
              prev.addEventListener("click", previousImg);
              prev.addEventListener("mouseenter", function() {likes.style.visibility = "hidden"})
              next.addEventListener("click", nextImg);
              next.addEventListener("mouseenter", function() {likes.style.visibility = "hidden"})
              backgroundChanger.addEventListener("click", removeImage);
            }
    }

    function previousImg(e) {
      e.stopPropagation();
        if (position === 0) {
          prev.style.opacity = .2;
          position = 0;
        } else {
          prev.style.opacity = 1;
          next.style.opacity = 1;
          position--;
          expandedImg.src = imageObj[position].source;
          caption.innerHTML = imageObj[position].caption;
          likes.innerHTML = imageObj[position].likes;
          location.innerHTML = imageObj[position].location
          currentImg = position;
          console.log(position, expandedImg.src);
        }
    }

    function nextImg(e) {
      e.stopPropagation();
      if (position < imageObj.length - 1) {
        position++
        expandedImg.src = imageObj[position].source;
        caption.innerHTML = imageObj[position].caption;
        likes.innerHTML = imageObj[position].likes;
        location.innerHTML = imageObj[position].location
        currentImg = position;
        prev.style.opacity = 1;
        next.style.opacity = 1;
        console.log(position, expandedImg.src);

      } else {
        next.style.opacity = .2;
        position = imageObj.length - 1;
      }
    }

    function removeImage() {
      document.body.removeChild(backgroundChanger);
      lightBox.removeChild(prev);
      lightBox.removeChild(next);
      backgroundChanger.removeChild(lightBox);
      lightBox.removeChild(expandedImg);
      backgroundChanger.removeEventListener("click", removeImage);
    }

  };

  window.onload = init();
  </script>

</html>
